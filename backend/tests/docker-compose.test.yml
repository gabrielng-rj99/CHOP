version: "3.8"

services:
    postgres-test:
        image: postgres:16-alpine
        container_name: contracts-test-db
        environment:
            POSTGRES_USER: test_user
            POSTGRES_PASSWORD: test_password
            POSTGRES_DB: contracts_test
            POSTGRES_INITDB_ARGS: "-E UTF8"
        ports:
            - "65432:5432"
        volumes:
            - postgres-test-data:/var/lib/postgresql/data
            - ../database/schema.sql:/docker-entrypoint-initdb.d/01-schema.sql:ro
            - ../migrations:/docker-entrypoint-initdb.d/02-migrations:ro
        healthcheck:
            test: ["CMD-SHELL", "pg_isready -U test_user -d contracts_test"]
            interval: 2s
            timeout: 5s
            retries: 10
        networks:
            - test-network

volumes:
    postgres-test-data:
        name: contracts-test-db-volume

networks:
    test-network:
        name: contracts-test-network
        driver: bridge
