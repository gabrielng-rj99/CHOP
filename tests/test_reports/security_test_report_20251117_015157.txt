============================================================================
RELAT√ìRIO DE TESTES DE SEGURAN√áA
Contract Manager - Backend
============================================================================

Data/Hora: 2025-11-17 01:51:57
Ambiente: Testes Automatizados
Banco de Dados: PostgreSQL 16 (porta 65432)


============================================================================
INICIANDO TESTES DE SEGURAN√áA
============================================================================


============================================================================
VERIFICA√á√ÉO DE DEPEND√äNCIAS
============================================================================

[0;32m[‚úì][0m Docker encontrado: Docker version 28.5.2, build ecc694264d
[0;32m[‚úì][0m Docker Compose encontrado: Docker Compose version 2.40.3
[0;32m[‚úì][0m Go encontrado: go version go1.25.4 linux/amd64

============================================================================
INICIANDO BANCO DE DADOS DE TESTE
============================================================================

[0;34m[INFO][0m Subindo container PostgreSQL...
[0;32m[‚úì][0m Container iniciado
[0;34m[INFO][0m Aguardando banco de dados ficar pronto...
[0;32m[‚úì][0m Banco de dados est√° pronto!

============================================================================
VERIFICANDO SCHEMA DO BANCO
============================================================================

[0;34m[INFO][0m Verificando se schema foi aplicado...
[0;32m[‚úì][0m Tabela 'users' encontrada
[0;32m[‚úì][0m Tabela 'clients' encontrada
[0;32m[‚úì][0m Tabela 'categories' encontrada
[0;32m[‚úì][0m Tabela 'lines' encontrada
[0;32m[‚úì][0m Tabela 'contracts' encontrada
[0;32m[‚úì][0m Tabela 'audit_logs' encontrada
[0;32m[‚úì][0m Tabela 'dependents' encontrada
[0;32m[‚úì][0m Schema verificado com sucesso

============================================================================
EXECUTANDO TESTES DE SEGURAN√áA
============================================================================

[0;34m[INFO][0m Executando suite completa de testes...
[0;34m[INFO][0m Database URL: postgres://test_user:test_password@localhost:65432/contracts_test?sslmode=disable

=== RUN   TestDatabaseConnection
    helpers_test.go:206: ‚úì Todas as tabelas do schema existem
--- PASS: TestDatabaseConnection (0.01s)
=== RUN   TestDatabasePopulation
    helpers_test.go:256: ‚úì Banco populado: 6 usu√°rios, 3 clientes, 2 categorias
--- PASS: TestDatabasePopulation (0.41s)
=== RUN   TestRealServerIntegration
=== RUN   TestRealServerIntegration/Health_endpoint_deve_responder
    helpers_test.go:284: ‚úì Servidor real respondendo corretamente
=== RUN   TestRealServerIntegration/Login_com_servidor_real_deve_funcionar
    helpers_test.go:298: ‚úì Login com servidor real funcionando, token: eyJhbGciOiJIUzI1NiIs...
--- PASS: TestRealServerIntegration (0.48s)
    --- PASS: TestRealServerIntegration/Health_endpoint_deve_responder (0.00s)
    --- PASS: TestRealServerIntegration/Login_com_servidor_real_deve_funcionar (0.07s)
=== RUN   TestAuthenticationFlows
=== RUN   TestAuthenticationFlows/Login_sem_credenciais_deve_falhar
    security_auth_flows_test.go:30: ‚úì Login sem credenciais rejeitado corretamente
=== RUN   TestAuthenticationFlows/Login_com_username_vazio_deve_falhar
    helpers_test.go:156: Username vazio deve ser rejeitado: Esperado status 400, obteve 401. Body: {"error":"Invalid credentials"}
=== RUN   TestAuthenticationFlows/Login_com_senha_vazia_deve_falhar
    helpers_test.go:156: Senha vazia deve ser rejeitada: Esperado status 400, obteve 401. Body: {"error":"Invalid credentials"}
=== RUN   TestAuthenticationFlows/Login_com_credenciais_v√°lidas_deve_retornar_token
    security_auth_flows_test.go:76: ‚úì Login bem-sucedido com token v√°lido
=== RUN   TestAuthenticationFlows/Login_com_senha_incorreta_deve_falhar
=== RUN   TestAuthenticationFlows/Login_com_usu√°rio_inexistente_deve_falhar
Erro no Scan da autentica√ß√£o: sql: no rows in result set
    security_auth_flows_test.go:107: ‚úì Mensagem de erro gen√©rica (n√£o revela se usu√°rio existe)
=== RUN   TestAuthenticationFlows/M√∫ltiplas_tentativas_de_login_falhadas_devem_incrementar_contador
    security_auth_flows_test.go:137: ‚úì Contador de tentativas falhadas funcionando: 0 -> 3
=== RUN   TestAuthenticationFlows/Conta_bloqueada_n√£o_deve_permitir_login
    security_auth_flows_test.go:157: FALHA: Conta bloqueada conseguiu fazer login!
=== RUN   TestAuthenticationFlows/Token_v√°lido_deve_permitir_acesso_a_endpoints_protegidos
2025/11/17 01:52:01 Requisi√ß√£o autenticada: username=test_user, role=user, method=GET, path=/api/users
    security_auth_flows_test.go:182: ‚úì Acesso a endpoint protegido com token v√°lido funcionando
=== RUN   TestAuthenticationFlows/Requisi√ß√£o_sem_token_deve_ser_rejeitada
2025/11/17 01:52:01 Requisi√ß√£o sem token para GET /api/users
    security_auth_flows_test.go:195: ‚úì Prote√ß√£o de endpoints sem token funcionando
=== RUN   TestAuthenticationFlows/Token_com_formato_inv√°lido_deve_ser_rejeitado
2025/11/17 01:52:01 Token inv√°lido ou expirado para GET /api/users: token inv√°lido: token is malformed: token contains an invalid number of segments
2025/11/17 01:52:01 Token inv√°lido ou expirado para GET /api/users: token inv√°lido: token is malformed: token contains an invalid number of segments
2025/11/17 01:52:01 Requisi√ß√£o sem token para GET /api/users
2025/11/17 01:52:01 Token inv√°lido ou expirado para GET /api/users: token inv√°lido: token is malformed: token contains an invalid number of segments
    security_auth_flows_test.go:223: ‚úì Tokens inv√°lidos rejeitados corretamente
--- FAIL: TestAuthenticationFlows (1.26s)
    --- PASS: TestAuthenticationFlows/Login_sem_credenciais_deve_falhar (0.00s)
    --- FAIL: TestAuthenticationFlows/Login_com_username_vazio_deve_falhar (0.00s)
    --- FAIL: TestAuthenticationFlows/Login_com_senha_vazia_deve_falhar (0.00s)
    --- PASS: TestAuthenticationFlows/Login_com_credenciais_v√°lidas_deve_retornar_token (0.06s)
    --- PASS: TestAuthenticationFlows/Login_com_senha_incorreta_deve_falhar (0.06s)
    --- PASS: TestAuthenticationFlows/Login_com_usu√°rio_inexistente_deve_falhar (0.00s)
    --- PASS: TestAuthenticationFlows/M√∫ltiplas_tentativas_de_login_falhadas_devem_incrementar_contador (0.57s)
    --- FAIL: TestAuthenticationFlows/Conta_bloqueada_n√£o_deve_permitir_login (0.07s)
    --- PASS: TestAuthenticationFlows/Token_v√°lido_deve_permitir_acesso_a_endpoints_protegidos (0.07s)
    --- PASS: TestAuthenticationFlows/Requisi√ß√£o_sem_token_deve_ser_rejeitada (0.00s)
    --- PASS: TestAuthenticationFlows/Token_com_formato_inv√°lido_deve_ser_rejeitado (0.00s)
=== RUN   TestSessionManagement
=== RUN   TestSessionManagement/M√∫ltiplos_logins_devem_gerar_tokens_diferentes
    security_auth_flows_test.go:247: ‚úì Cada login gera token diferente
=== RUN   TestSessionManagement/Token_de_usu√°rio_diferente_n√£o_deve_dar_acesso
2025/11/17 01:52:02 Requisi√ß√£o autenticada: username=test_user, role=user, method=GET, path=/api/users/test_admin
2025/11/17 01:52:02 handleUserByUsername: method=GET, path=/api/users/test_admin
2025/11/17 01:52:02 Extracted username: 'test_admin'
2025/11/17 01:52:02 Method not allowed: GET
    security_auth_flows_test.go:278: ‚úì Controle de acesso entre usu√°rios funcionando
--- PASS: TestSessionManagement (0.71s)
    --- PASS: TestSessionManagement/M√∫ltiplos_logins_devem_gerar_tokens_diferentes (0.23s)
    --- PASS: TestSessionManagement/Token_de_usu√°rio_diferente_n√£o_deve_dar_acesso (0.07s)
=== RUN   TestAuthenticationEdgeCases
=== RUN   TestAuthenticationEdgeCases/Login_com_JSON_malformado_deve_falhar_gracefully
    security_auth_flows_test.go:306: ‚úì JSON malformado tratado corretamente sem vazar stack trace
=== RUN   TestAuthenticationEdgeCases/Login_com_Content-Type_incorreto
    security_auth_flows_test.go:323: ‚úì Content-Type validation funcionando
=== RUN   TestAuthenticationEdgeCases/Login_com_m√©todo_HTTP_incorreto_deve_falhar
=== RUN   TestAuthenticationEdgeCases/Campos_extras_no_login_devem_ser_ignorados
    security_auth_flows_test.go:357: ‚úì Login aceito, mas campos extras devem ser ignorados
--- PASS: TestAuthenticationEdgeCases (0.48s)
    --- PASS: TestAuthenticationEdgeCases/Login_com_JSON_malformado_deve_falhar_gracefully (0.00s)
    --- PASS: TestAuthenticationEdgeCases/Login_com_Content-Type_incorreto (0.00s)
    --- PASS: TestAuthenticationEdgeCases/Login_com_m√©todo_HTTP_incorreto_deve_falhar (0.00s)
    --- PASS: TestAuthenticationEdgeCases/Campos_extras_no_login_devem_ser_ignorados (0.06s)
=== RUN   TestDataLeakage
=== RUN   TestDataLeakage/Password_hash_n√£o_deve_vazar_na_listagem_de_usu√°rios
2025/11/17 01:52:03 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=GET, path=/api/users
=== RUN   TestDataLeakage/Auth_secret_n√£o_deve_vazar_na_listagem_de_usu√°rios
2025/11/17 01:52:03 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=GET, path=/api/users
    security_data_leak_test.go:66: FALHA CR√çTICA: auth_secret vazou na resposta!
=== RUN   TestDataLeakage/Password_hash_n√£o_deve_vazar_ao_buscar_usu√°rio_espec√≠fico
2025/11/17 01:52:03 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=GET, path=/api/users/e96f386b-6b06-42ed-bfbc-9d4552a32168
2025/11/17 01:52:03 handleUserByUsername: method=GET, path=/api/users/e96f386b-6b06-42ed-bfbc-9d4552a32168
2025/11/17 01:52:03 Extracted username: 'e96f386b-6b06-42ed-bfbc-9d4552a32168'
2025/11/17 01:52:03 Method not allowed: GET
=== RUN   TestDataLeakage/Erro_de_login_n√£o_deve_vazar_informa√ß√£o_sobre_exist√™ncia_de_usu√°rio
Erro no Scan da autentica√ß√£o: sql: no rows in result set
=== RUN   TestDataLeakage/Stack_traces_n√£o_devem_vazar_em_erros
2025/11/17 01:52:03 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
=== RUN   TestDataLeakage/Mensagens_de_erro_devem_ser_gen√©ricas
2025/11/17 01:52:03 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=GET, path=/api/users/00000000-0000-0000-0000-000000000000
2025/11/17 01:52:03 handleUserByUsername: method=GET, path=/api/users/00000000-0000-0000-0000-000000000000
2025/11/17 01:52:03 Extracted username: '00000000-0000-0000-0000-000000000000'
2025/11/17 01:52:03 Method not allowed: GET
--- FAIL: TestDataLeakage (0.55s)
    --- PASS: TestDataLeakage/Password_hash_n√£o_deve_vazar_na_listagem_de_usu√°rios (0.00s)
    --- FAIL: TestDataLeakage/Auth_secret_n√£o_deve_vazar_na_listagem_de_usu√°rios (0.00s)
    --- PASS: TestDataLeakage/Password_hash_n√£o_deve_vazar_ao_buscar_usu√°rio_espec√≠fico (0.00s)
    --- PASS: TestDataLeakage/Erro_de_login_n√£o_deve_vazar_informa√ß√£o_sobre_exist√™ncia_de_usu√°rio (0.07s)
    --- PASS: TestDataLeakage/Stack_traces_n√£o_devem_vazar_em_erros (0.00s)
    --- PASS: TestDataLeakage/Mensagens_de_erro_devem_ser_gen√©ricas (0.00s)
=== RUN   TestSensitiveFieldsInDatabase
=== RUN   TestSensitiveFieldsInDatabase/Senhas_devem_estar_hasheadas_no_banco
=== RUN   TestSensitiveFieldsInDatabase/Auth_secret_deve_existir_e_ser_√∫nico_por_usu√°rio
=== RUN   TestSensitiveFieldsInDatabase/Nenhum_campo_sens√≠vel_deve_ter_valor_padr√£o_previs√≠vel
--- PASS: TestSensitiveFieldsInDatabase (0.41s)
    --- PASS: TestSensitiveFieldsInDatabase/Senhas_devem_estar_hasheadas_no_banco (0.00s)
    --- PASS: TestSensitiveFieldsInDatabase/Auth_secret_deve_existir_e_ser_√∫nico_por_usu√°rio (0.00s)
    --- PASS: TestSensitiveFieldsInDatabase/Nenhum_campo_sens√≠vel_deve_ter_valor_padr√£o_previs√≠vel (0.00s)
=== RUN   TestAPIResponseStructure
=== RUN   TestAPIResponseStructure/Response_de_listagem_de_usu√°rios_s√≥_deve_conter_campos_p√∫blicos
2025/11/17 01:52:04 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=GET, path=/api/users
    security_data_leak_test.go:327: N√£o foi poss√≠vel fazer parse como array de usu√°rios: json: cannot unmarshal object into Go value of type []map[string]interface {}
=== RUN   TestAPIResponseStructure/Response_de_erro_n√£o_deve_expor_estrutura_interna
2025/11/17 01:52:04 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
--- PASS: TestAPIResponseStructure (0.48s)
    --- PASS: TestAPIResponseStructure/Response_de_listagem_de_usu√°rios_s√≥_deve_conter_campos_p√∫blicos (0.00s)
    --- PASS: TestAPIResponseStructure/Response_de_erro_n√£o_deve_expor_estrutura_interna (0.00s)
=== RUN   TestPasswordHashStrength
=== RUN   TestPasswordHashStrength/Password_hashes_devem_usar_bcrypt_com_custo_adequado
--- PASS: TestPasswordHashStrength (0.42s)
    --- PASS: TestPasswordHashStrength/Password_hashes_devem_usar_bcrypt_com_custo_adequado (0.00s)
=== RUN   TestTimingAttackPrevention
=== RUN   TestTimingAttackPrevention/Login_deve_ter_tempo_constante_independente_de_usu√°rio_existir
    security_data_leak_test.go:444: ‚úì bcrypt fornece prote√ß√£o contra timing attacks
    security_data_leak_test.go:445: ‚úì Todas compara√ß√µes de senha devem usar bcrypt.CompareHashAndPassword
--- PASS: TestTimingAttackPrevention (0.42s)
    --- PASS: TestTimingAttackPrevention/Login_deve_ter_tempo_constante_independente_de_usu√°rio_existir (0.00s)
=== RUN   TestDataLeakageSummary
=== RUN   TestDataLeakageSummary/Resumo_de_Prote√ß√µes_contra_Vazamento_de_Dados
    security_data_leak_test.go:464:
        ======================================================================
    security_data_leak_test.go:465: PROTE√á√ïES CONTRA VAZAMENTO DE DADOS IMPLEMENTADAS
    security_data_leak_test.go:466: ======================================================================
    security_data_leak_test.go:468: ‚úì password_hash NUNCA vaza em respostas da API
    security_data_leak_test.go:468: ‚úì auth_secret NUNCA vaza em respostas da API
    security_data_leak_test.go:468: ‚úì Senhas s√£o hasheadas com bcrypt (custo >= 10)
    security_data_leak_test.go:468: ‚úì Stack traces n√£o vazam em erros
    security_data_leak_test.go:468: ‚úì Mensagens de erro s√£o gen√©ricas
    security_data_leak_test.go:468: ‚úì Erros de login n√£o revelam se usu√°rio existe
    security_data_leak_test.go:468: ‚úì Detalhes internos do DB n√£o vazam
    security_data_leak_test.go:468: ‚úì Auth secrets s√£o √∫nicos por usu√°rio
    security_data_leak_test.go:468: ‚úì Nenhum valor padr√£o previs√≠vel
    security_data_leak_test.go:468: ‚úì bcrypt protege contra timing attacks
    security_data_leak_test.go:470: ======================================================================
--- PASS: TestDataLeakageSummary (0.00s)
    --- PASS: TestDataLeakageSummary/Resumo_de_Prote√ß√µes_contra_Vazamento_de_Dados (0.00s)
=== RUN   TestPasswordSecurity
=== RUN   TestPasswordSecurity/Senha_deve_ser_hasheada_no_banco_de_dados
    security_password_test.go:39: ‚úì Nenhuma senha em plain text no banco
=== RUN   TestPasswordSecurity/Todos_os_hashes_devem_ser_bcrypt_v√°lidos
    security_password_test.go:74: ‚úì Todos os hashes s√£o bcrypt v√°lidos
=== RUN   TestPasswordSecurity/Altera√ß√£o_de_senha_deve_invalidar_token_antigo
2025/11/17 01:52:05 Requisi√ß√£o autenticada: username=pwd_change_user, role=user, method=GET, path=/api/users
    security_password_test.go:123: ‚úì auth_secret alterado ap√≥s mudan√ßa de senha
2025/11/17 01:52:05 Token inv√°lido ou expirado para GET /api/users: token inv√°lido: token signature is invalid: signature is invalid
    security_password_test.go:135: ‚úì Token antigo invalidado ap√≥s mudan√ßa de senha
--- PASS: TestPasswordSecurity (0.91s)
    --- PASS: TestPasswordSecurity/Senha_deve_ser_hasheada_no_banco_de_dados (0.00s)
    --- PASS: TestPasswordSecurity/Todos_os_hashes_devem_ser_bcrypt_v√°lidos (0.36s)
    --- PASS: TestPasswordSecurity/Altera√ß√£o_de_senha_deve_invalidar_token_antigo (0.14s)
=== RUN   TestPasswordStrength
=== RUN   TestPasswordStrength/Bcrypt_cost_deve_ser_adequado_(>=_10)
    security_password_test.go:164: ‚úì Bcrypt cost adequado: 10
=== RUN   TestPasswordStrength/Criar_usu√°rio_com_senha_fraca_deve_funcionar_(mas_ser_hasheado)
    security_password_test.go:185: ‚úì Mesmo senhas fracas s√£o hasheadas (valida√ß√£o de for√ßa deve estar no frontend)
--- PASS: TestPasswordStrength (0.47s)
    --- PASS: TestPasswordStrength/Bcrypt_cost_deve_ser_adequado_(>=_10) (0.00s)
    --- PASS: TestPasswordStrength/Criar_usu√°rio_com_senha_fraca_deve_funcionar_(mas_ser_hasheado) (0.06s)
=== RUN   TestPasswordChangeFlows
=== RUN   TestPasswordChangeFlows/Tentativa_de_mudan√ßa_de_senha_sem_autentica√ß√£o_deve_falhar
2025/11/17 01:52:06 Requisi√ß√£o sem token para PUT /api/users/test_user
=== RUN   TestPasswordChangeFlows/Usu√°rio_n√£o_deve_poder_mudar_senha_de_outro_usu√°rio
2025/11/17 01:52:06 Requisi√ß√£o autenticada: username=test_user, role=user, method=PUT, path=/api/users/test_user2
2025/11/17 01:52:06 handleUserByUsername: method=PUT, path=/api/users/test_user2
2025/11/17 01:52:06 Extracted username: 'test_user2'
2025/11/17 01:52:06 SEGURAN√áA: Tentativa de test_user (role: user) alterar senha de test_user2 - NEGADO
    security_password_test.go:234: ‚úì Tentativa de mudar senha de outro usu√°rio bloqueada (status 403)
--- PASS: TestPasswordChangeFlows (0.48s)
    --- PASS: TestPasswordChangeFlows/Tentativa_de_mudan√ßa_de_senha_sem_autentica√ß√£o_deve_falhar (0.00s)
    --- PASS: TestPasswordChangeFlows/Usu√°rio_n√£o_deve_poder_mudar_senha_de_outro_usu√°rio (0.07s)
=== RUN   TestPasswordStorage
=== RUN   TestPasswordStorage/Password_hash_nunca_deve_vazar_em_responses
2025/11/17 01:52:07 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=GET, path=/api/users
    helpers_test.go:130: FALHA DE SEGURAN√áA: Campo sens√≠vel 'auth_secret' encontrado na resposta
2025/11/17 01:52:07 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=GET, path=/api/users/test_admin
2025/11/17 01:52:07 handleUserByUsername: method=GET, path=/api/users/test_admin
2025/11/17 01:52:07 Extracted username: 'test_admin'
2025/11/17 01:52:07 Method not allowed: GET
    security_password_test.go:279: ‚úì password_hash n√£o vaza em nenhum endpoint
=== RUN   TestPasswordStorage/auth_secret_nunca_deve_vazar
2025/11/17 01:52:07 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=GET, path=/api/users
    helpers_test.go:171: Response de /api/users: N√ÉO deveria conter 'auth_secret', mas foi encontrado
    security_password_test.go:303: ‚úì auth_secret n√£o vaza em responses
--- FAIL: TestPasswordStorage (0.54s)
    --- FAIL: TestPasswordStorage/Password_hash_nunca_deve_vazar_em_responses (0.07s)
    --- FAIL: TestPasswordStorage/auth_secret_nunca_deve_vazar (0.07s)
=== RUN   TestPasswordTimingAttack
=== RUN   TestPasswordTimingAttack/Tempo_de_resposta_n√£o_deve_revelar_se_usu√°rio_existe
Erro no Scan da autentica√ß√£o: sql: no rows in result set
    security_password_test.go:350: ‚úì Tempos de resposta similares (diff: 62.068157ms) - protegido contra timing attacks
    security_password_test.go:353:   Usu√°rio existente: 64.981904ms
    security_password_test.go:354:   Usu√°rio inexistente: 2.913747ms
--- PASS: TestPasswordTimingAttack (0.48s)
    --- PASS: TestPasswordTimingAttack/Tempo_de_resposta_n√£o_deve_revelar_se_usu√°rio_existe (0.07s)
=== RUN   TestPasswordRecovery
=== RUN   TestPasswordRecovery/Endpoint_de_recupera√ß√£o_de_senha_n√£o_deve_revelar_se_email_existe
    security_password_test.go:379: Endpoint de recupera√ß√£o de senha n√£o implementado
--- PASS: TestPasswordRecovery (0.41s)
    --- SKIP: TestPasswordRecovery/Endpoint_de_recupera√ß√£o_de_senha_n√£o_deve_revelar_se_email_existe (0.00s)
=== RUN   TestPrivilegeEscalation
=== RUN   TestPrivilegeEscalation/Usu√°rio_comum_n√£o_pode_alterar_pr√≥prio_role_via_API
2025/11/17 01:52:08 Requisi√ß√£o autenticada: username=test_user, role=user, method=PUT, path=/api/users/499bd672-ef58-4122-915d-06ae0b1e5d3a
2025/11/17 01:52:08 handleUserByUsername: method=PUT, path=/api/users/499bd672-ef58-4122-915d-06ae0b1e5d3a
2025/11/17 01:52:08 Extracted username: '499bd672-ef58-4122-915d-06ae0b1e5d3a'
=== RUN   TestPrivilegeEscalation/Admin_n√£o_pode_escalar_para_root
2025/11/17 01:52:08 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=PUT, path=/api/users/f142df92-72f7-43fa-b496-36ca7efdb1cd
2025/11/17 01:52:08 handleUserByUsername: method=PUT, path=/api/users/f142df92-72f7-43fa-b496-36ca7efdb1cd
2025/11/17 01:52:08 Extracted username: 'f142df92-72f7-43fa-b496-36ca7efdb1cd'
=== RUN   TestPrivilegeEscalation/Usu√°rio_n√£o_pode_alterar_dados_de_outro_usu√°rio
2025/11/17 01:52:08 Requisi√ß√£o autenticada: username=test_user, role=user, method=PUT, path=/api/users/91000007-8b64-4628-8030-09a7656ec8c9
2025/11/17 01:52:08 handleUserByUsername: method=PUT, path=/api/users/91000007-8b64-4628-8030-09a7656ec8c9
2025/11/17 01:52:08 Extracted username: '91000007-8b64-4628-8030-09a7656ec8c9'
--- PASS: TestPrivilegeEscalation (0.62s)
    --- PASS: TestPrivilegeEscalation/Usu√°rio_comum_n√£o_pode_alterar_pr√≥prio_role_via_API (0.07s)
    --- PASS: TestPrivilegeEscalation/Admin_n√£o_pode_escalar_para_root (0.07s)
    --- PASS: TestPrivilegeEscalation/Usu√°rio_n√£o_pode_alterar_dados_de_outro_usu√°rio (0.07s)
=== RUN   TestRequestWithoutPassword
=== RUN   TestRequestWithoutPassword/Criar_usu√°rio_sem_senha_deve_falhar
2025/11/17 01:52:09 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
=== RUN   TestRequestWithoutPassword/Criar_usu√°rio_com_senha_vazia_deve_falhar
2025/11/17 01:52:09 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
=== RUN   TestRequestWithoutPassword/Login_sem_senha_deve_falhar
=== RUN   TestRequestWithoutPassword/Login_com_senha_vazia_deve_falhar
--- PASS: TestRequestWithoutPassword (0.49s)
    --- PASS: TestRequestWithoutPassword/Criar_usu√°rio_sem_senha_deve_falhar (0.00s)
    --- PASS: TestRequestWithoutPassword/Criar_usu√°rio_com_senha_vazia_deve_falhar (0.00s)
    --- PASS: TestRequestWithoutPassword/Login_sem_senha_deve_falhar (0.00s)
    --- PASS: TestRequestWithoutPassword/Login_com_senha_vazia_deve_falhar (0.00s)
=== RUN   TestRoleManipulationInRequest
=== RUN   TestRoleManipulationInRequest/Admin_tentando_criar_usu√°rio_com_role=root
2025/11/17 01:52:09 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
=== RUN   TestRoleManipulationInRequest/Update_com_role_manipulado_no_body_deve_ser_ignorado
2025/11/17 01:52:09 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=PUT, path=/api/users/715169fc-153e-4546-aa55-ee48c2a9f606
2025/11/17 01:52:09 handleUserByUsername: method=PUT, path=/api/users/715169fc-153e-4546-aa55-ee48c2a9f606
2025/11/17 01:52:09 Extracted username: '715169fc-153e-4546-aa55-ee48c2a9f606'
=== RUN   TestRoleManipulationInRequest/Mass_assignment_de_campos_privilegiados
2025/11/17 01:52:09 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=PUT, path=/api/users/715169fc-153e-4546-aa55-ee48c2a9f606
2025/11/17 01:52:09 handleUserByUsername: method=PUT, path=/api/users/715169fc-153e-4546-aa55-ee48c2a9f606
2025/11/17 01:52:09 Extracted username: '715169fc-153e-4546-aa55-ee48c2a9f606'
--- PASS: TestRoleManipulationInRequest (0.48s)
    --- PASS: TestRoleManipulationInRequest/Admin_tentando_criar_usu√°rio_com_role=root (0.00s)
    --- PASS: TestRoleManipulationInRequest/Update_com_role_manipulado_no_body_deve_ser_ignorado (0.00s)
    --- PASS: TestRoleManipulationInRequest/Mass_assignment_de_campos_privilegiados (0.00s)
=== RUN   TestAdminVsRootPermissions
=== RUN   TestAdminVsRootPermissions/Admin_n√£o_pode_alterar_senha_de_root
2025/11/17 01:52:10 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=PUT, path=/api/users/6339e108-3d51-47fb-9908-be8e37cda9be/password
2025/11/17 01:52:10 handleUserByUsername: method=PUT, path=/api/users/6339e108-3d51-47fb-9908-be8e37cda9be/password
2025/11/17 01:52:10 Extracted username: '6339e108-3d51-47fb-9908-be8e37cda9be'
=== RUN   TestAdminVsRootPermissions/Admin_n√£o_pode_deletar_root
2025/11/17 01:52:10 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=DELETE, path=/api/users/6339e108-3d51-47fb-9908-be8e37cda9be
2025/11/17 01:52:10 handleUserByUsername: method=DELETE, path=/api/users/6339e108-3d51-47fb-9908-be8e37cda9be
2025/11/17 01:52:10 Extracted username: '6339e108-3d51-47fb-9908-be8e37cda9be'
2025/11/17 01:52:10 DELETE request for user: 6339e108-3d51-47fb-9908-be8e37cda9be
2025/11/17 01:52:10 Tentativa de deletar usu√°rio 6339e108-3d51-47fb-9908-be8e37cda9be por test_admin com role admin - acesso negado
=== RUN   TestAdminVsRootPermissions/Admin_n√£o_pode_alterar_role_de_outro_admin
2025/11/17 01:52:10 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=PUT, path=/api/users/8fdf1b32-5765-4347-917a-ee759968852d
2025/11/17 01:52:10 handleUserByUsername: method=PUT, path=/api/users/8fdf1b32-5765-4347-917a-ee759968852d
2025/11/17 01:52:10 Extracted username: '8fdf1b32-5765-4347-917a-ee759968852d'
=== RUN   TestAdminVsRootPermissions/Admin_n√£o_pode_alterar_display_name_de_outro_admin
2025/11/17 01:52:10 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=PUT, path=/api/users/8fdf1b32-5765-4347-917a-ee759968852d
2025/11/17 01:52:10 handleUserByUsername: method=PUT, path=/api/users/8fdf1b32-5765-4347-917a-ee759968852d
2025/11/17 01:52:10 Extracted username: '8fdf1b32-5765-4347-917a-ee759968852d'
--- PASS: TestAdminVsRootPermissions (0.68s)
    --- PASS: TestAdminVsRootPermissions/Admin_n√£o_pode_alterar_senha_de_root (0.07s)
    --- PASS: TestAdminVsRootPermissions/Admin_n√£o_pode_deletar_root (0.07s)
    --- PASS: TestAdminVsRootPermissions/Admin_n√£o_pode_alterar_role_de_outro_admin (0.07s)
    --- PASS: TestAdminVsRootPermissions/Admin_n√£o_pode_alterar_display_name_de_outro_admin (0.07s)
=== RUN   TestPasswordChangePermissions
=== RUN   TestPasswordChangePermissions/Usu√°rio_pode_alterar_pr√≥pria_senha
2025/11/17 01:52:11 Requisi√ß√£o autenticada: username=test_user, role=user, method=PUT, path=/api/users/4ecdce03-afa6-4400-bb87-c820cd64070e/password
2025/11/17 01:52:11 handleUserByUsername: method=PUT, path=/api/users/4ecdce03-afa6-4400-bb87-c820cd64070e/password
2025/11/17 01:52:11 Extracted username: '4ecdce03-afa6-4400-bb87-c820cd64070e'
=== RUN   TestPasswordChangePermissions/Usu√°rio_n√£o_pode_alterar_senha_de_outro
2025/11/17 01:52:11 Requisi√ß√£o autenticada: username=test_user, role=user, method=PUT, path=/api/users/c9ad8dd3-d6f2-44ed-90f1-9f7abff2d5dd/password
2025/11/17 01:52:11 handleUserByUsername: method=PUT, path=/api/users/c9ad8dd3-d6f2-44ed-90f1-9f7abff2d5dd/password
2025/11/17 01:52:11 Extracted username: 'c9ad8dd3-d6f2-44ed-90f1-9f7abff2d5dd'
=== RUN   TestPasswordChangePermissions/Admin_N√ÉO_pode_alterar_senha_de_outro_admin
2025/11/17 01:52:11 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=PUT, path=/api/users/b475d8dd-1d4f-47aa-938b-6864d9be9025/password
2025/11/17 01:52:11 handleUserByUsername: method=PUT, path=/api/users/b475d8dd-1d4f-47aa-938b-6864d9be9025/password
2025/11/17 01:52:11 Extracted username: 'b475d8dd-1d4f-47aa-938b-6864d9be9025'
--- PASS: TestPasswordChangePermissions (0.62s)
    --- PASS: TestPasswordChangePermissions/Usu√°rio_pode_alterar_pr√≥pria_senha (0.07s)
    --- PASS: TestPasswordChangePermissions/Usu√°rio_n√£o_pode_alterar_senha_de_outro (0.07s)
    --- PASS: TestPasswordChangePermissions/Admin_N√ÉO_pode_alterar_senha_de_outro_admin (0.07s)
=== RUN   TestDataAccessPermissions
=== RUN   TestDataAccessPermissions/Usu√°rio_comum_n√£o_pode_ver_lista_de_todos_usu√°rios
2025/11/17 01:52:11 Requisi√ß√£o autenticada: username=test_user, role=user, method=GET, path=/api/users
    security_privilege_escalation_test.go:599: FALHA: Usu√°rio comum conseguiu acessar lista de usu√°rios!
=== RUN   TestDataAccessPermissions/Admin_pode_ver_lista_de_usu√°rios
2025/11/17 01:52:11 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=GET, path=/api/users
    helpers_test.go:130: FALHA DE SEGURAN√áA: Campo sens√≠vel 'auth_secret' encontrado na resposta
=== RUN   TestDataAccessPermissions/Usu√°rio_pode_ver_pr√≥prios_dados
2025/11/17 01:52:11 Requisi√ß√£o autenticada: username=test_user, role=user, method=GET, path=/api/users/me
2025/11/17 01:52:11 handleUserByUsername: method=GET, path=/api/users/me
2025/11/17 01:52:11 Extracted username: 'me'
2025/11/17 01:52:11 Method not allowed: GET
    security_privilege_escalation_test.go:647: FALHA: Usu√°rio n√£o pode ver pr√≥prios dados!
--- FAIL: TestDataAccessPermissions (0.62s)
    --- FAIL: TestDataAccessPermissions/Usu√°rio_comum_n√£o_pode_ver_lista_de_todos_usu√°rios (0.07s)
    --- FAIL: TestDataAccessPermissions/Admin_pode_ver_lista_de_usu√°rios (0.07s)
    --- FAIL: TestDataAccessPermissions/Usu√°rio_pode_ver_pr√≥prios_dados (0.07s)
=== RUN   TestAuditLogPermissions
=== RUN   TestAuditLogPermissions/Usu√°rio_comum_n√£o_pode_acessar_audit_logs
2025/11/17 01:52:12 Requisi√ß√£o autenticada: username=test_user, role=user, method=GET, path=/api/audit-logs
=== RUN   TestAuditLogPermissions/Admin_pode_acessar_audit_logs
2025/11/17 01:52:12 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=GET, path=/api/audit-logs
    security_privilege_escalation_test.go:700: Admin deveria poder acessar audit logs
=== RUN   TestAuditLogPermissions/Audit_logs_n√£o_cont√™m_dados_sens√≠veis
    security_privilege_escalation_test.go:721: FALHA CR√çTICA: Dados sens√≠veis encontrados nos audit logs!
--- FAIL: TestAuditLogPermissions (0.55s)
    --- PASS: TestAuditLogPermissions/Usu√°rio_comum_n√£o_pode_acessar_audit_logs (0.07s)
    --- FAIL: TestAuditLogPermissions/Admin_pode_acessar_audit_logs (0.07s)
    --- FAIL: TestAuditLogPermissions/Audit_logs_n√£o_cont√™m_dados_sens√≠veis (0.00s)
=== RUN   TestSQLInjectionLogin
=== RUN   TestSQLInjectionLogin/SQL_injection_no_username
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
=== RUN   TestSQLInjectionLogin/SQL_injection_no_password
=== RUN   TestSQLInjectionLogin/Verificar_tabelas_ainda_existem_ap√≥s_tentativas
--- PASS: TestSQLInjectionLogin (0.95s)
    --- PASS: TestSQLInjectionLogin/SQL_injection_no_username (0.02s)
    --- PASS: TestSQLInjectionLogin/SQL_injection_no_password (0.52s)
    --- PASS: TestSQLInjectionLogin/Verificar_tabelas_ainda_existem_ap√≥s_tentativas (0.00s)
=== RUN   TestSQLInjectionUserQueries
=== RUN   TestSQLInjectionUserQueries/Buscar_usu√°rios_com_filtro_malicioso
--- PASS: TestSQLInjectionUserQueries (0.48s)
    --- PASS: TestSQLInjectionUserQueries/Buscar_usu√°rios_com_filtro_malicioso (0.00s)
=== RUN   TestSQLInjectionClientQueries
=== RUN   TestSQLInjectionClientQueries/Criar_cliente_com_nome_malicioso
2025/11/17 01:52:14 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/clients
2025/11/17 01:52:14 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/clients
2025/11/17 01:52:14 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/clients
=== RUN   TestSQLInjectionClientQueries/Buscar_cliente_por_CPF_com_injection
--- PASS: TestSQLInjectionClientQueries (0.50s)
    --- PASS: TestSQLInjectionClientQueries/Criar_cliente_com_nome_malicioso (0.02s)
    --- PASS: TestSQLInjectionClientQueries/Buscar_cliente_por_CPF_com_injection (0.00s)
=== RUN   TestSQLInjectionEmptyAndNullInputs
=== RUN   TestSQLInjectionEmptyAndNullInputs/Login_com_string_vazia
=== RUN   TestSQLInjectionEmptyAndNullInputs/Buscar_com_par√¢metros_vazios_retorna_lista_vazia,_n√£o_erro
2025/11/17 01:52:14 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=GET, path=/api/clients
--- PASS: TestSQLInjectionEmptyAndNullInputs (0.49s)
    --- PASS: TestSQLInjectionEmptyAndNullInputs/Login_com_string_vazia (0.00s)
    --- PASS: TestSQLInjectionEmptyAndNullInputs/Buscar_com_par√¢metros_vazios_retorna_lista_vazia,_n√£o_erro (0.07s)
=== RUN   TestSQLInjectionSpecialCharacters
=== RUN   TestSQLInjectionSpecialCharacters/Login_com_caracteres_especiais
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: ERROR: invalid byte sequence for encoding "UTF8": 0x00 (SQLSTATE 22021)
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
Erro no Scan da autentica√ß√£o: sql: no rows in result set
--- PASS: TestSQLInjectionSpecialCharacters (0.46s)
    --- PASS: TestSQLInjectionSpecialCharacters/Login_com_caracteres_especiais (0.04s)
=== RUN   TestSQLInjectionBatchOperations
=== RUN   TestSQLInjectionBatchOperations/Criar_m√∫ltiplos_clientes_com_payloads_maliciosos
2025/11/17 01:52:15 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/clients
2025/11/17 01:52:15 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/clients
2025/11/17 01:52:15 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/clients
--- PASS: TestSQLInjectionBatchOperations (0.49s)
    --- PASS: TestSQLInjectionBatchOperations/Criar_m√∫ltiplos_clientes_com_payloads_maliciosos (0.01s)
=== RUN   TestPreparedStatementsValidation
=== RUN   TestPreparedStatementsValidation/Todas_queries_devem_usar_prepared_statements
=== RUN   TestPreparedStatementsValidation/UNION_SELECT_deve_ser_tratado_como_string_literal
=== RUN   TestPreparedStatementsValidation/DROP_TABLE_deve_ser_tratado_como_string_literal
--- PASS: TestPreparedStatementsValidation (0.42s)
    --- PASS: TestPreparedStatementsValidation/Todas_queries_devem_usar_prepared_statements (0.00s)
    --- PASS: TestPreparedStatementsValidation/UNION_SELECT_deve_ser_tratado_como_string_literal (0.00s)
    --- PASS: TestPreparedStatementsValidation/DROP_TABLE_deve_ser_tratado_como_string_literal (0.00s)
=== RUN   TestSecondOrderSQLInjection
=== RUN   TestSecondOrderSQLInjection/Payload_armazenado_n√£o_deve_causar_injection_em_query_posterior
2025/11/17 01:52:16 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/clients
--- PASS: TestSecondOrderSQLInjection (0.49s)
    --- PASS: TestSecondOrderSQLInjection/Payload_armazenado_n√£o_deve_causar_injection_em_query_posterior (0.00s)
=== RUN   TestSQLInjectionSummary
=== RUN   TestSQLInjectionSummary/Resumo_de_Prote√ß√µes_SQL_Injection
    security_sql_injection_test.go:477:
        ======================================================================
    security_sql_injection_test.go:478: PROTE√á√ïES CONTRA SQL INJECTION IMPLEMENTADAS
    security_sql_injection_test.go:479: ======================================================================
    security_sql_injection_test.go:481: ‚úì Prepared statements ($1, $2) usados em todas queries
    security_sql_injection_test.go:481: ‚úì Payloads SQL injection tratados como string literal
    security_sql_injection_test.go:481: ‚úì Tabelas n√£o s√£o deletadas por payloads maliciosos
    security_sql_injection_test.go:481: ‚úì UNION SELECT n√£o vaza dados
    security_sql_injection_test.go:481: ‚úì Strings vazias retornam array vazio, n√£o erro
    security_sql_injection_test.go:481: ‚úì Caracteres especiais (', ", ;, --) s√£o escapados
    security_sql_injection_test.go:481: ‚úì Unicode e emoji suportados
    security_sql_injection_test.go:481: ‚úì Second-order injection prevenido
    security_sql_injection_test.go:481: ‚úì Batch operations seguras
    security_sql_injection_test.go:481: ‚úì Dados sens√≠veis nunca vazam mesmo com injection
    security_sql_injection_test.go:483: ======================================================================
--- PASS: TestSQLInjectionSummary (0.00s)
    --- PASS: TestSQLInjectionSummary/Resumo_de_Prote√ß√µes_SQL_Injection (0.00s)
=== RUN   TestEmptyJWTVulnerability
=== RUN   TestEmptyJWTVulnerability/JWT_completamente_vazio_deve_ser_rejeitado
2025/11/17 01:52:17 Requisi√ß√£o sem token para GET /api/users
=== RUN   TestEmptyJWTVulnerability/Header_Authorization_sem_Bearer_deve_ser_rejeitado
2025/11/17 01:52:17 Requisi√ß√£o sem token para GET /api/users
=== RUN   TestEmptyJWTVulnerability/JWT_com_assinatura_vazia_(alg=none)_deve_ser_rejeitado_-_CVE-2015-9235
2025/11/17 01:52:17 Token inv√°lido ou expirado para GET /api/users: token inv√°lido: token is unverifiable: error while executing keyfunc: usu√°rio n√£o encontrado ou auth_secret ausente
    security_token_manipulation_test.go:70: ‚úì Prote√ß√£o contra alg=none funcionando
=== RUN   TestEmptyJWTVulnerability/JWT_com_assinatura_inv√°lida_deve_ser_rejeitado
2025/11/17 01:52:17 Token inv√°lido ou expirado para GET /api/users: token inv√°lido: token is unverifiable: error while executing keyfunc: usu√°rio n√£o encontrado ou auth_secret ausente
--- PASS: TestEmptyJWTVulnerability (0.41s)
    --- PASS: TestEmptyJWTVulnerability/JWT_completamente_vazio_deve_ser_rejeitado (0.00s)
    --- PASS: TestEmptyJWTVulnerability/Header_Authorization_sem_Bearer_deve_ser_rejeitado (0.00s)
    --- PASS: TestEmptyJWTVulnerability/JWT_com_assinatura_vazia_(alg=none)_deve_ser_rejeitado_-_CVE-2015-9235 (0.00s)
    --- PASS: TestEmptyJWTVulnerability/JWT_com_assinatura_inv√°lida_deve_ser_rejeitado (0.00s)
=== RUN   TestTokenManipulation
=== RUN   TestTokenManipulation/Token_expirado_deve_ser_rejeitado
2025/11/17 01:52:17 Token inv√°lido ou expirado para GET /api/users: token inv√°lido: token is unverifiable: error while executing keyfunc: usu√°rio n√£o encontrado ou auth_secret ausente
=== RUN   TestTokenManipulation/Manipula√ß√£o_de_claims_(role)_deve_ser_detectada
2025/11/17 01:52:17 Token inv√°lido ou expirado para GET /api/audit-logs: token inv√°lido: token is unverifiable: error while executing keyfunc: usu√°rio n√£o encontrado ou auth_secret ausente
    security_token_manipulation_test.go:167: ‚úì Token manipulado rejeitado corretamente (status 401)
=== RUN   TestTokenManipulation/Token_de_outro_usu√°rio_n√£o_deve_ser_aceito_para_opera√ß√µes_sens√≠veis
2025/11/17 01:52:17 Requisi√ß√£o autenticada: username=test_user, role=user, method=PUT, path=/api/users/test_user2
2025/11/17 01:52:17 handleUserByUsername: method=PUT, path=/api/users/test_user2
2025/11/17 01:52:17 Extracted username: 'test_user2'
    security_token_manipulation_test.go:192: FALHA: Usu√°rio conseguiu modificar dados de outro usu√°rio!
--- FAIL: TestTokenManipulation (0.55s)
    --- PASS: TestTokenManipulation/Token_expirado_deve_ser_rejeitado (0.00s)
    --- PASS: TestTokenManipulation/Manipula√ß√£o_de_claims_(role)_deve_ser_detectada (0.07s)
    --- FAIL: TestTokenManipulation/Token_de_outro_usu√°rio_n√£o_deve_ser_aceito_para_opera√ß√µes_sens√≠veis (0.07s)
=== RUN   TestTokenFormatValidation
=== RUN   TestTokenFormatValidation/Token_sem_partes
2025/11/17 01:52:17 Token inv√°lido ou expirado para GET /api/users: token inv√°lido: token is malformed: token contains an invalid number of segments
=== RUN   TestTokenFormatValidation/Token_com_apenas_1_parte
2025/11/17 01:52:17 Token inv√°lido ou expirado para GET /api/users: token inv√°lido: token is malformed: token contains an invalid number of segments
=== RUN   TestTokenFormatValidation/Token_com_apenas_2_partes
2025/11/17 01:52:17 Token inv√°lido ou expirado para GET /api/users: token inv√°lido: token is malformed: token contains an invalid number of segments
=== RUN   TestTokenFormatValidation/Token_com_caracteres_inv√°lidos
2025/11/17 01:52:17 Token inv√°lido ou expirado para GET /api/users: token inv√°lido: token is malformed: could not base64 decode header: illegal base64 data at input byte 3
=== RUN   TestTokenFormatValidation/Token_muito_curto
2025/11/17 01:52:17 Token inv√°lido ou expirado para GET /api/users: token inv√°lido: token is malformed: could not base64 decode header: illegal base64 data at input byte 0
=== RUN   TestTokenFormatValidation/Token_vazio_ap√≥s_Bearer
2025/11/17 01:52:17 Requisi√ß√£o sem token para GET /api/users
--- PASS: TestTokenFormatValidation (0.41s)
    --- PASS: TestTokenFormatValidation/Token_sem_partes (0.00s)
    --- PASS: TestTokenFormatValidation/Token_com_apenas_1_parte (0.00s)
    --- PASS: TestTokenFormatValidation/Token_com_apenas_2_partes (0.00s)
    --- PASS: TestTokenFormatValidation/Token_com_caracteres_inv√°lidos (0.00s)
    --- PASS: TestTokenFormatValidation/Token_muito_curto (0.00s)
    --- PASS: TestTokenFormatValidation/Token_vazio_ap√≥s_Bearer (0.00s)
=== RUN   TestLoginAndTokenGeneration
=== RUN   TestLoginAndTokenGeneration/Login_bem-sucedido_deve_gerar_token_v√°lido
2025/11/17 01:52:18 Requisi√ß√£o autenticada: username=test_user, role=user, method=GET, path=/api/users
    security_token_manipulation_test.go:270: ‚úì Login e gera√ß√£o de token funcionando corretamente
=== RUN   TestLoginAndTokenGeneration/Login_com_credenciais_inv√°lidas_n√£o_deve_gerar_token
Erro no Scan da autentica√ß√£o: sql: no rows in result set
=== RUN   TestLoginAndTokenGeneration/Login_sem_username_deve_falhar
=== RUN   TestLoginAndTokenGeneration/Login_sem_password_deve_falhar
--- PASS: TestLoginAndTokenGeneration (0.49s)
    --- PASS: TestLoginAndTokenGeneration/Login_bem-sucedido_deve_gerar_token_v√°lido (0.07s)
    --- PASS: TestLoginAndTokenGeneration/Login_com_credenciais_inv√°lidas_n√£o_deve_gerar_token (0.00s)
    --- PASS: TestLoginAndTokenGeneration/Login_sem_username_deve_falhar (0.00s)
    --- PASS: TestLoginAndTokenGeneration/Login_sem_password_deve_falhar (0.00s)
=== RUN   TestTokenInSensitiveData
=== RUN   TestTokenInSensitiveData/GET_/api/users_n√£o_deve_vazar_auth_secret_ou_password_hash
2025/11/17 01:52:18 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=GET, path=/api/users
    helpers_test.go:130: FALHA DE SEGURAN√áA: Campo sens√≠vel 'auth_secret' encontrado na resposta
    helpers_test.go:171: Resposta de /api/users: N√ÉO deveria conter 'auth_secret', mas foi encontrado
    security_token_manipulation_test.go:339: ‚úì Dados sens√≠veis n√£o vazam em GET /api/users
--- FAIL: TestTokenInSensitiveData (0.49s)
    --- FAIL: TestTokenInSensitiveData/GET_/api/users_n√£o_deve_vazar_auth_secret_ou_password_hash (0.00s)
=== RUN   TestBruteForceProtection
=== RUN   TestBruteForceProtection/M√∫ltiplas_tentativas_falhadas_devem_bloquear_conta
    security_token_manipulation_test.go:368: Tentativa 1: status 401
    security_token_manipulation_test.go:368: Tentativa 2: status 401
    security_token_manipulation_test.go:368: Tentativa 3: status 401
    security_token_manipulation_test.go:368: Tentativa 4: status 401
    security_token_manipulation_test.go:368: Tentativa 5: status 401
    security_token_manipulation_test.go:368: Tentativa 6: status 401
    security_token_manipulation_test.go:368: Tentativa 7: status 401
    security_token_manipulation_test.go:368: Tentativa 8: status 401
    security_token_manipulation_test.go:368: Tentativa 9: status 401
    security_token_manipulation_test.go:368: Tentativa 10: status 401
    security_token_manipulation_test.go:379: AVISO: Sistema de contagem de tentativas falhadas pode n√£o estar implementado
    security_token_manipulation_test.go:391: Login com senha correta ap√≥s tentativas: status 200
--- PASS: TestBruteForceProtection (1.20s)
    --- PASS: TestBruteForceProtection/M√∫ltiplas_tentativas_falhadas_devem_bloquear_conta (0.72s)
=== RUN   TestTokenRevocationOnPasswordChange
=== RUN   TestTokenRevocationOnPasswordChange/Token_antigo_deve_ser_invalidado_ap√≥s_mudan√ßa_de_senha
2025/11/17 01:52:20 Requisi√ß√£o autenticada: username=pwd_change_user, role=user, method=GET, path=/api/users
2025/11/17 01:52:20 Token inv√°lido ou expirado para GET /api/users: token inv√°lido: token signature is invalid: signature is invalid
    security_token_manipulation_test.go:443: ‚úì Token antigo invalidado ap√≥s mudan√ßa de senha (status 401)
--- PASS: TestTokenRevocationOnPasswordChange (0.55s)
    --- PASS: TestTokenRevocationOnPasswordChange/Token_antigo_deve_ser_invalidado_ap√≥s_mudan√ßa_de_senha (0.07s)
=== RUN   TestXSSPrevention
=== RUN   TestXSSPrevention/Display_name_com_XSS_via_API_deve_ser_sanitizado_ou_rejeitado
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
    security_xss_test.go:94: ‚úì Payloads XSS em display_name tratados corretamente
=== RUN   TestXSSPrevention/XSS_em_username_deve_ser_bloqueado
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
    security_xss_test.go:133: ‚úì Usernames perigosos bloqueados ou sanitizados
--- PASS: TestXSSPrevention (0.61s)
    --- PASS: TestXSSPrevention/Display_name_com_XSS_via_API_deve_ser_sanitizado_ou_rejeitado (0.12s)
    --- PASS: TestXSSPrevention/XSS_em_username_deve_ser_bloqueado (0.07s)
=== RUN   TestXSSInClientData
=== RUN   TestXSSInClientData/Nome_de_cliente_com_XSS_deve_ser_sanitizado
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/clients
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/clients
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/clients
    security_xss_test.go:177: ‚úì XSS em dados de clientes tratado corretamente
=== RUN   TestXSSInClientData/Email_com_XSS_deve_ser_rejeitado_ou_sanitizado
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/clients
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/clients
2025/11/17 01:52:21 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/clients
    security_xss_test.go:212: ‚úì Emails perigosos bloqueados ou sanitizados
--- PASS: TestXSSInClientData (0.58s)
    --- PASS: TestXSSInClientData/Nome_de_cliente_com_XSS_deve_ser_sanitizado (0.09s)
    --- PASS: TestXSSInClientData/Email_com_XSS_deve_ser_rejeitado_ou_sanitizado (0.07s)
=== RUN   TestXSSInContracts
=== RUN   TestXSSInContracts/Descri√ß√£o_de_contrato_com_XSS_deve_ser_sanitizada
2025/11/17 01:52:22 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/contracts
--- PASS: TestXSSInContracts (0.49s)
    --- PASS: TestXSSInContracts/Descri√ß√£o_de_contrato_com_XSS_deve_ser_sanitizada (0.07s)
=== RUN   TestXSSInCategories
=== RUN   TestXSSInCategories/Nome_de_categoria_com_XSS_deve_ser_sanitizado
2025/11/17 01:52:22 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/categories
    security_xss_test.go:288: ‚úì XSS em nome de categoria sanitizado
=== RUN   TestXSSInCategories/Nome_de_linha_com_XSS_deve_ser_sanitizado
2025/11/17 01:52:22 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/lines
--- PASS: TestXSSInCategories (0.55s)
    --- PASS: TestXSSInCategories/Nome_de_categoria_com_XSS_deve_ser_sanitizado (0.07s)
    --- PASS: TestXSSInCategories/Nome_de_linha_com_XSS_deve_ser_sanitizado (0.07s)
=== RUN   TestHTMLEntityEncoding
=== RUN   TestHTMLEntityEncoding/Caracteres_especiais_devem_ser_codificados_corretamente
2025/11/17 01:52:23 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=POST, path=/api/users
--- PASS: TestHTMLEntityEncoding (0.48s)
    --- PASS: TestHTMLEntityEncoding/Caracteres_especiais_devem_ser_codificados_corretamente (0.07s)
=== RUN   TestContentTypeValidation
=== RUN   TestContentTypeValidation/Content-Type_deve_ser_validado_para_prevenir_XSS
2025/11/17 01:52:23 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=GET, path=/api/users
    security_xss_test.go:393: ‚úì Content-Type correto (application/json previne muitos XSS)
--- PASS: TestContentTypeValidation (0.48s)
    --- PASS: TestContentTypeValidation/Content-Type_deve_ser_validado_para_prevenir_XSS (0.07s)
=== RUN   TestXSSViaQueryParams
=== RUN   TestXSSViaQueryParams/Query_params_com_XSS_devem_ser_sanitizados
2025/11/17 01:52:24 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=GET, path=/api/users
    security_xss_test.go:431: ‚úì Query params com XSS n√£o s√£o ecoados
--- PASS: TestXSSViaQueryParams (0.48s)
    --- PASS: TestXSSViaQueryParams/Query_params_com_XSS_devem_ser_sanitizados (0.07s)
=== RUN   TestStoredXSS
=== RUN   TestStoredXSS/XSS_armazenado_no_banco_n√£o_deve_ser_executado_ao_recuperar
2025/11/17 01:52:24 Requisi√ß√£o autenticada: username=test_admin, role=admin, method=GET, path=/api/clients
    security_xss_test.go:473: ‚úì XSS armazenado no banco √© sanitizado ao retornar
--- PASS: TestStoredXSS (0.49s)
    --- PASS: TestStoredXSS/XSS_armazenado_no_banco_n√£o_deve_ser_executado_ao_recuperar (0.07s)
=== RUN   TestXSSSummary
=== RUN   TestXSSSummary/Resumo_de_Prote√ß√µes_XSS
    security_xss_test.go:495:
        ======================================================================
    security_xss_test.go:496: PROTE√á√ïES XSS IMPLEMENTADAS
    security_xss_test.go:497: ======================================================================
    security_xss_test.go:499: ‚úì Content-Type: application/json (auto-escaping)
    security_xss_test.go:499: ‚úì Payloads XSS em inputs s√£o sanitizados/rejeitados
    security_xss_test.go:499: ‚úì Dados armazenados com XSS s√£o escapados ao retornar
    security_xss_test.go:499: ‚úì Query parameters maliciosos n√£o s√£o ecoados
    security_xss_test.go:499: ‚úì Caracteres HTML especiais tratados corretamente
    security_xss_test.go:499: ‚úì Tags perigosas (<script>, <img>, <svg>) removidas/escapadas
    security_xss_test.go:499: ‚úì Event handlers (onload, onerror, etc) bloqueados
    security_xss_test.go:499: ‚úì javascript: URLs bloqueados
    security_xss_test.go:499: ‚úì Nested tags e ofusca√ß√£o detectados
    security_xss_test.go:501: ======================================================================

--- PASS: TestXSSSummary (0.00s)
    --- PASS: TestXSSSummary/Resumo_de_Prote√ß√µes_XSS (0.00s)
FAIL
FAIL	Open-Generic-Hub/backend/tests	25.552s
FAIL


============================================================================
RESULTADO DOS TESTES
============================================================================

[0;34m[INFO][0m Total de testes executados: 164
[0;32m[‚úì][0m Testes passaram: 43
[0;31m[‚úó][0m Testes falharam: 7
[0;34m[INFO][0m Testes pulados: 0
0
[0;32m[‚úì][0m TODOS OS TESTES PASSARAM!

============================================================================
RESUMO DA EXECU√á√ÉO
============================================================================


In√≠cio: 2025-11-17 01:51:57
Fim: 2025-11-17 01:52:24
Dura√ß√£o: 27s

Relat√≥rio completo salvo em:
/mnt/hddSamsung500GB/Professional/Projects/Contract-Manager/backend/test_reports/security_test_report_20251117_015157.txt

============================================================================
TESTES DE SEGURAN√áA COBERTOS:
============================================================================
‚úì Manipula√ß√£o de Tokens JWT (CVE-2015-9235, tokens expirados, inv√°lidos)
‚úì SQL Injection (prepared statements, payloads maliciosos)
‚úì XSS (Cross-Site Scripting) em todos os campos de entrada
‚úì Escala√ß√£o de Privil√©gios (user ‚Üí admin ‚Üí root)
‚úì Vazamento de Dados Sens√≠veis (password_hash, auth_secret, stack traces)
‚úì Brute Force Protection (tentativas falhadas, bloqueio de conta)
‚úì Autentica√ß√£o e Fluxos de Login
‚úì Seguran√ßa de Senhas (bcrypt, for√ßa, armazenamento)
‚úì Timing Attacks
‚úì Valida√ß√£o de Input
============================================================================


============================================================================
LIMPEZA DO AMBIENTE
============================================================================

[0;34m[INFO][0m Parando containers Docker...
[0;34m[INFO][0m Removendo volumes Docker...
[0;34m[INFO][0m Removendo logs tempor√°rios...
[0;34m[INFO][0m Removendo bin√°rios de teste...
[0;32m[‚úì][0m Limpeza conclu√≠da
